{"remainingRequest":"c:\\Users\\joe\\source\\repos\\TunnelQuest\\TunnelQuest.Web\\SPA\\node_modules\\thread-loader\\dist\\cjs.js!c:\\Users\\joe\\source\\repos\\TunnelQuest\\TunnelQuest.Web\\SPA\\node_modules\\ts-loader\\index.js??ref--12-2!c:\\Users\\joe\\source\\repos\\TunnelQuest\\TunnelQuest.Web\\SPA\\src\\classes\\TQGlobals.ts","dependencies":[{"path":"c:\\Users\\joe\\source\\repos\\TunnelQuest\\TunnelQuest.Web\\SPA\\src\\classes\\TQGlobals.ts","mtime":1554164632505},{"path":"c:\\Users\\joe\\source\\repos\\TunnelQuest\\TunnelQuest.Web\\SPA\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"c:\\Users\\joe\\source\\repos\\TunnelQuest\\TunnelQuest.Web\\SPA\\node_modules\\thread-loader\\dist\\cjs.js","mtime":499162500000},{"path":"c:\\Users\\joe\\source\\repos\\TunnelQuest\\TunnelQuest.Web\\SPA\\node_modules\\ts-loader\\index.js","mtime":1545640398000}],"contextDependencies":[],"result":["import axios from \"axios\";\r\nimport ItemRepo from \"../classes/ItemRepo\";\r\nimport SpellRepo from \"../classes/SpellRepo\";\r\nimport PriceHistoryRepo from \"../classes/PriceHistoryRepo\";\r\nvar TQGlobals = /** @class */ (function () {\r\n    function TQGlobals() {\r\n    }\r\n    TQGlobals.init = function (callback) {\r\n        var _this = this;\r\n        if (this.settings)\r\n            callback(); // already initialized; callback immediately\r\n        else {\r\n            this.initCallbacks.push(callback);\r\n            if (!this.isInitializing) {\r\n                this.isInitializing = true;\r\n                //stub\r\n                console.log(\"TQGlobals initializing, making ajax call to api/settings\");\r\n                axios.get('/api/settings')\r\n                    .then(function (response) {\r\n                    _this.serverCode = \"BLUE\"; // STUB hard-coded\r\n                    _this.settings = response.data;\r\n                    _this.spells = new SpellRepo();\r\n                    _this.items = new ItemRepo(_this.spells);\r\n                    _this.priceHistories = new PriceHistoryRepo(_this.serverCode);\r\n                    // make sure all aliases are lowercase\r\n                    var aliasesToFix = new Array();\r\n                    for (var aliasText in _this.settings.aliases) {\r\n                        var lowerAliasText = aliasText.toLowerCase();\r\n                        if (aliasText != lowerAliasText) {\r\n                            // it was not already lowercase\r\n                            aliasesToFix.push(aliasText);\r\n                        }\r\n                    }\r\n                    for (var _i = 0, aliasesToFix_1 = aliasesToFix; _i < aliasesToFix_1.length; _i++) {\r\n                        var aliasText = aliasesToFix_1[_i];\r\n                        var lowerAliasText = aliasText.toLowerCase();\r\n                        _this.settings.aliases[lowerAliasText] = _this.settings.aliases[aliasText];\r\n                        delete _this.settings.aliases[aliasText];\r\n                    }\r\n                    // build settings.aliasesByItemName\r\n                    _this.settings.aliasesByItemName = {};\r\n                    for (var aliasText in _this.settings.aliases) {\r\n                        var itemName = _this.settings.aliases[aliasText];\r\n                        if (!_this.settings.aliasesByItemName[itemName])\r\n                            _this.settings.aliasesByItemName[itemName] = new Array();\r\n                        _this.settings.aliasesByItemName[itemName].push(aliasText);\r\n                    }\r\n                    // attempt to load previous filter settings from localstorage\r\n                    var existingFiltersJson = localStorage.getItem(\"Filters\");\r\n                    if (existingFiltersJson == null) {\r\n                        // no previously saved filter was found; use default filter values\r\n                        _this.filters = {};\r\n                        _this.filters.matchAny = true;\r\n                        _this.filters.itemNames = [];\r\n                    }\r\n                    else {\r\n                        _this.filters = JSON.parse(existingFiltersJson);\r\n                    }\r\n                    _this.isInitializing = false;\r\n                    _this.isInitialized = true;\r\n                    for (var _a = 0, _b = _this.initCallbacks; _a < _b.length; _a++) {\r\n                        var callback_1 = _b[_a];\r\n                        callback_1();\r\n                    }\r\n                })\r\n                    .catch(function (err) {\r\n                    _this.isInitializing = false;\r\n                    // stub\r\n                    console.log(err);\r\n                }); // end axios.get(settings)\r\n            }\r\n        }\r\n    };\r\n    TQGlobals.saveFilter = function () {\r\n        if (this.isInitialized)\r\n            localStorage.setItem(\"Filters\", JSON.stringify(this.filters));\r\n    };\r\n    // utility / helper functions\r\n    // if itemName is an alias such as \"schw\" or \"fbss\", return the actual itemName; otherwi\r\n    TQGlobals.resolveItemAlias = function (itemName) {\r\n        if (!itemName)\r\n            return itemName;\r\n        var realItemName = this.settings.aliases[itemName.toLowerCase()];\r\n        if (realItemName)\r\n            return realItemName;\r\n        else\r\n            return itemName;\r\n    };\r\n    // code lifted from this stackoverflow post: https://stackoverflow.com/questions/2901102/how-to-print-a-number-with-commas-as-thousands-separators-in-javascript\r\n    TQGlobals.formatNumber = function (numberToFormat, decimals, dec_point, thousands_sep) {\r\n        var n = !isFinite(+numberToFormat) ? 0 : +numberToFormat, prec = !isFinite(+decimals) ? 0 : Math.abs(decimals), sep = (typeof thousands_sep === 'undefined') ? ',' : thousands_sep, dec = (typeof dec_point === 'undefined') ? '.' : dec_point, toFixedFix = function (n, prec) {\r\n            // Fix for IE parseFloat(0.55).toFixed(0) = 0;\r\n            var k = Math.pow(10, prec);\r\n            return Math.round(n * k) / k;\r\n        }, s = (prec ? toFixedFix(n, prec) : Math.round(n)).toString().split('.');\r\n        if (s[0].length > 3) {\r\n            s[0] = s[0].replace(/\\B(?=(?:\\d{3})+(?!\\d))/g, sep);\r\n        }\r\n        if ((s[1] || '').length < prec) {\r\n            s[1] = s[1] || '';\r\n            s[1] += new Array(prec - s[1].length + 1).join('0');\r\n        }\r\n        return s.join(dec);\r\n    };\r\n    TQGlobals.isInitializing = false;\r\n    TQGlobals.initCallbacks = new Array();\r\n    TQGlobals.isInitialized = false;\r\n    return TQGlobals;\r\n}());\r\nexport default TQGlobals;\r\n",{"version":3,"file":"c:\\Users\\joe\\source\\repos\\TunnelQuest\\TunnelQuest.Web\\SPA\\src\\classes\\TQGlobals.ts","sourceRoot":"","sources":["c:\\Users\\joe\\source\\repos\\TunnelQuest\\TunnelQuest.Web\\SPA\\src\\classes\\TQGlobals.ts"],"names":[],"mappings":"AAAA,OAAO,KAAK,MAAM,OAAO,CAAC;AAK1B,OAAO,QAAQ,MAAM,qBAAqB,CAAC;AAC3C,OAAO,SAAS,MAAM,sBAAsB,CAAC;AAC7C,OAAO,gBAAgB,MAAM,6BAA6B,CAAC;AAE3D;IAAA;IAkIA,CAAC;IArHU,cAAI,GAAX,UAAY,QAAkB;QAA9B,iBAwEC;QAtEG,IAAI,IAAI,CAAC,QAAQ;YACb,QAAQ,EAAE,CAAC,CAAC,4CAA4C;aACvD;YACD,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;YAElC,IAAI,CAAC,IAAI,CAAC,cAAc,EAAE;gBACtB,IAAI,CAAC,cAAc,GAAG,IAAI,CAAC;gBAE3B,MAAM;gBACN,OAAO,CAAC,GAAG,CAAC,0DAA0D,CAAC,CAAC;gBAExE,KAAK,CAAC,GAAG,CAAC,eAAe,CAAC;qBACrB,IAAI,CAAC,UAAA,QAAQ;oBACV,KAAI,CAAC,UAAU,GAAG,MAAM,CAAC,CAAC,kBAAkB;oBAC5C,KAAI,CAAC,QAAQ,GAAG,QAAQ,CAAC,IAAgB,CAAC;oBAC1C,KAAI,CAAC,MAAM,GAAG,IAAI,SAAS,EAAE,CAAC;oBAC9B,KAAI,CAAC,KAAK,GAAG,IAAI,QAAQ,CAAC,KAAI,CAAC,MAAM,CAAC,CAAC;oBACvC,KAAI,CAAC,cAAc,GAAG,IAAI,gBAAgB,CAAC,KAAI,CAAC,UAAU,CAAC,CAAC;oBAE5D,sCAAsC;oBACtC,IAAI,YAAY,GAAG,IAAI,KAAK,EAAU,CAAC;oBACvC,KAAK,IAAI,SAAS,IAAI,KAAI,CAAC,QAAQ,CAAC,OAAO,EAAE;wBACzC,IAAI,cAAc,GAAG,SAAS,CAAC,WAAW,EAAE,CAAC;wBAC7C,IAAI,SAAS,IAAI,cAAc,EAAE;4BAC7B,+BAA+B;4BAC/B,YAAY,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;yBAChC;qBACJ;oBACD,KAAsB,UAAY,EAAZ,6BAAY,EAAZ,0BAAY,EAAZ,IAAY,EAAE;wBAA/B,IAAI,SAAS,qBAAA;wBACd,IAAI,cAAc,GAAG,SAAS,CAAC,WAAW,EAAE,CAAC;wBAC7C,KAAI,CAAC,QAAQ,CAAC,OAAO,CAAC,cAAc,CAAC,GAAG,KAAI,CAAC,QAAQ,CAAC,OAAO,CAAC,SAAS,CAAC,CAAC;wBACzE,OAAO,KAAI,CAAC,QAAQ,CAAC,OAAO,CAAC,SAAS,CAAC,CAAC;qBAC3C;oBAED,mCAAmC;oBACnC,KAAI,CAAC,QAAQ,CAAC,iBAAiB,GAAG,EAAE,CAAC;oBACrC,KAAK,IAAI,SAAS,IAAI,KAAI,CAAC,QAAQ,CAAC,OAAO,EAAE;wBACzC,IAAI,QAAQ,GAAG,KAAI,CAAC,QAAQ,CAAC,OAAO,CAAC,SAAS,CAAC,CAAC;wBAChD,IAAI,CAAC,KAAI,CAAC,QAAQ,CAAC,iBAAiB,CAAC,QAAQ,CAAC;4BAC1C,KAAI,CAAC,QAAQ,CAAC,iBAAiB,CAAC,QAAQ,CAAC,GAAG,IAAI,KAAK,EAAU,CAAC;wBACpE,KAAI,CAAC,QAAQ,CAAC,iBAAiB,CAAC,QAAQ,CAAC,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;qBAC7D;oBAED,6DAA6D;oBAC7D,IAAI,mBAAmB,GAAG,YAAY,CAAC,OAAO,CAAC,SAAS,CAAC,CAAC;oBAC1D,IAAI,mBAAmB,IAAI,IAAI,EAAE;wBAC7B,kEAAkE;wBAClE,KAAI,CAAC,OAAO,GAAG,EAAa,CAAC;wBAC7B,KAAI,CAAC,OAAO,CAAC,QAAQ,GAAG,IAAI,CAAC;wBAC7B,KAAI,CAAC,OAAO,CAAC,SAAS,GAAG,EAAE,CAAC;qBAC/B;yBACI;wBACD,KAAI,CAAC,OAAO,GAAG,IAAI,CAAC,KAAK,CAAC,mBAAmB,CAAC,CAAC;qBAClD;oBAED,KAAI,CAAC,cAAc,GAAG,KAAK,CAAC;oBAC5B,KAAI,CAAC,aAAa,GAAG,IAAI,CAAC;oBAE1B,KAAqB,UAAkB,EAAlB,KAAA,KAAI,CAAC,aAAa,EAAlB,cAAkB,EAAlB,IAAkB,EAAE;wBAApC,IAAI,UAAQ,SAAA;wBACb,UAAQ,EAAE,CAAC;qBACd;gBACL,CAAC,CAAC;qBACD,KAAK,CAAC,UAAA,GAAG;oBACN,KAAI,CAAC,cAAc,GAAG,KAAK,CAAC;oBAE5B,OAAO;oBACP,OAAO,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;gBACrB,CAAC,CAAC,CAAC,CAAC,0BAA0B;aACrC;SACJ;IACL,CAAC;IAGM,oBAAU,GAAjB;QACI,IAAI,IAAI,CAAC,aAAa;YAClB,YAAY,CAAC,OAAO,CAAC,SAAS,EAAE,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC,CAAC;IACtE,CAAC;IAED,6BAA6B;IAE7B,wFAAwF;IACjF,0BAAgB,GAAvB,UAAwB,QAAgB;QACpC,IAAI,CAAC,QAAQ;YACT,OAAO,QAAQ,CAAC;QAEpB,IAAI,YAAY,GAAG,IAAI,CAAC,QAAQ,CAAC,OAAO,CAAC,QAAQ,CAAC,WAAW,EAAE,CAAC,CAAC;QAEjE,IAAI,YAAY;YACZ,OAAO,YAAY,CAAC;;YAEpB,OAAO,QAAQ,CAAC;IACxB,CAAC;IAED,gKAAgK;IACzJ,sBAAY,GAAnB,UAAoB,cAAsB,EAAE,QAAgB,EAAE,SAAiB,EAAE,aAAqB;QAClG,IAAI,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC,cAAc,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,cAAc,EACpD,IAAI,GAAG,CAAC,QAAQ,CAAC,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,QAAQ,CAAC,EACpD,GAAG,GAAG,CAAC,OAAO,aAAa,KAAK,WAAW,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,aAAa,EAClE,GAAG,GAAG,CAAC,OAAO,SAAS,KAAK,WAAW,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,SAAS,EAC1D,UAAU,GAAG,UAAU,CAAS,EAAE,IAAY;YAC1C,8CAA8C;YAC9C,IAAI,CAAC,GAAG,IAAI,CAAC,GAAG,CAAC,EAAE,EAAE,IAAI,CAAC,CAAC;YAC3B,OAAO,IAAI,CAAC,KAAK,CAAC,CAAC,GAAG,CAAC,CAAC,GAAG,CAAC,CAAC;QACjC,CAAC,EACD,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC,CAAC,UAAU,CAAC,CAAC,EAAE,IAAI,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC,QAAQ,EAAE,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;QAC3E,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC,MAAM,GAAG,CAAC,EAAE;YACjB,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,OAAO,CAAC,yBAAyB,EAAE,GAAG,CAAC,CAAC;SACvD;QACD,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC,IAAI,EAAE,CAAC,CAAC,MAAM,GAAG,IAAI,EAAE;YAC5B,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,IAAI,EAAE,CAAC;YAClB,CAAC,CAAC,CAAC,CAAC,IAAI,IAAI,KAAK,CAAC,IAAI,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;SACvD;QACD,OAAO,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;IACvB,CAAC;IA9Hc,wBAAc,GAAY,KAAK,CAAC;IAChC,uBAAa,GAAoB,IAAI,KAAK,EAAY,CAAC;IAE/D,uBAAa,GAAY,KAAK,CAAC;IA6H1C,gBAAC;CAAA,AAlID,IAkIC;AAED,eAAe,SAAS,CAAC","sourcesContent":["import axios from \"axios\";\r\n\r\nimport Settings from \"../interfaces/Settings\";\r\nimport Filters from \"../interfaces/Filters\";\r\n\r\nimport ItemRepo from \"../classes/ItemRepo\";\r\nimport SpellRepo from \"../classes/SpellRepo\";\r\nimport PriceHistoryRepo from \"../classes/PriceHistoryRepo\";\r\n\r\nclass TQGlobals {\r\n\r\n    private static isInitializing: boolean = false;\r\n    private static initCallbacks: Array<Function> = new Array<Function>();\r\n\r\n    static isInitialized: boolean = false;\r\n    static settings: Settings;\r\n    static filters: Filters;\r\n    static items: ItemRepo;\r\n    static spells: SpellRepo;\r\n    static priceHistories: PriceHistoryRepo;\r\n    static serverCode: string;\r\n\r\n    static init(callback: Function) {\r\n\r\n        if (this.settings)\r\n            callback(); // already initialized; callback immediately\r\n        else {\r\n            this.initCallbacks.push(callback);\r\n\r\n            if (!this.isInitializing) {\r\n                this.isInitializing = true;\r\n\r\n                //stub\r\n                console.log(\"TQGlobals initializing, making ajax call to api/settings\");\r\n\r\n                axios.get('/api/settings')\r\n                    .then(response => {\r\n                        this.serverCode = \"BLUE\"; // STUB hard-coded\r\n                        this.settings = response.data as Settings;\r\n                        this.spells = new SpellRepo();\r\n                        this.items = new ItemRepo(this.spells);\r\n                        this.priceHistories = new PriceHistoryRepo(this.serverCode);\r\n\r\n                        // make sure all aliases are lowercase\r\n                        let aliasesToFix = new Array<string>();\r\n                        for (let aliasText in this.settings.aliases) {\r\n                            let lowerAliasText = aliasText.toLowerCase();\r\n                            if (aliasText != lowerAliasText) {\r\n                                // it was not already lowercase\r\n                                aliasesToFix.push(aliasText);\r\n                            }\r\n                        }\r\n                        for (let aliasText of aliasesToFix) {\r\n                            let lowerAliasText = aliasText.toLowerCase();\r\n                            this.settings.aliases[lowerAliasText] = this.settings.aliases[aliasText];\r\n                            delete this.settings.aliases[aliasText];\r\n                        }\r\n\r\n                        // build settings.aliasesByItemName\r\n                        this.settings.aliasesByItemName = {};\r\n                        for (let aliasText in this.settings.aliases) {\r\n                            let itemName = this.settings.aliases[aliasText];\r\n                            if (!this.settings.aliasesByItemName[itemName])\r\n                                this.settings.aliasesByItemName[itemName] = new Array<string>();\r\n                            this.settings.aliasesByItemName[itemName].push(aliasText);\r\n                        }\r\n\r\n                        // attempt to load previous filter settings from localstorage\r\n                        let existingFiltersJson = localStorage.getItem(\"Filters\");\r\n                        if (existingFiltersJson == null) {\r\n                            // no previously saved filter was found; use default filter values\r\n                            this.filters = {} as Filters;\r\n                            this.filters.matchAny = true;\r\n                            this.filters.itemNames = [];\r\n                        }\r\n                        else {\r\n                            this.filters = JSON.parse(existingFiltersJson);\r\n                        }\r\n\r\n                        this.isInitializing = false;\r\n                        this.isInitialized = true;\r\n\r\n                        for (let callback of this.initCallbacks) {\r\n                            callback();\r\n                        }\r\n                    })\r\n                    .catch(err => {\r\n                        this.isInitializing = false;\r\n\r\n                        // stub\r\n                        console.log(err);\r\n                    }); // end axios.get(settings)\r\n            }\r\n        }\r\n    }\r\n\r\n\r\n    static saveFilter() {\r\n        if (this.isInitialized)\r\n            localStorage.setItem(\"Filters\", JSON.stringify(this.filters));\r\n    }\r\n\r\n    // utility / helper functions\r\n\r\n    // if itemName is an alias such as \"schw\" or \"fbss\", return the actual itemName; otherwi\r\n    static resolveItemAlias(itemName: string) {\r\n        if (!itemName)\r\n            return itemName;\r\n\r\n        let realItemName = this.settings.aliases[itemName.toLowerCase()];\r\n\r\n        if (realItemName)\r\n            return realItemName;\r\n        else\r\n            return itemName;\r\n    }\r\n\r\n    // code lifted from this stackoverflow post: https://stackoverflow.com/questions/2901102/how-to-print-a-number-with-commas-as-thousands-separators-in-javascript\r\n    static formatNumber(numberToFormat: number, decimals: number, dec_point: string, thousands_sep: string) {\r\n        var n = !isFinite(+numberToFormat) ? 0 : +numberToFormat,\r\n            prec = !isFinite(+decimals) ? 0 : Math.abs(decimals),\r\n            sep = (typeof thousands_sep === 'undefined') ? ',' : thousands_sep,\r\n            dec = (typeof dec_point === 'undefined') ? '.' : dec_point,\r\n            toFixedFix = function (n: number, prec: number) {\r\n                // Fix for IE parseFloat(0.55).toFixed(0) = 0;\r\n                var k = Math.pow(10, prec);\r\n                return Math.round(n * k) / k;\r\n            },\r\n            s = (prec ? toFixedFix(n, prec) : Math.round(n)).toString().split('.');\r\n        if (s[0].length > 3) {\r\n            s[0] = s[0].replace(/\\B(?=(?:\\d{3})+(?!\\d))/g, sep);\r\n        }\r\n        if ((s[1] || '').length < prec) {\r\n            s[1] = s[1] || '';\r\n            s[1] += new Array(prec - s[1].length + 1).join('0');\r\n        }\r\n        return s.join(dec);\r\n    }\r\n\r\n}\r\n\r\nexport default TQGlobals;"]}]}